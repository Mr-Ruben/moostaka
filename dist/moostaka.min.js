var Moostaka=function(opts){this.routes=[];this.defaultRoute="#/";this.viewLocation="/views";if(location.hash===""){window.location=this.defaultRoute}if(opts){this.defaultRoute=typeof opts.defaultRoute!=="undefined"?opts.defaultRoute:this.defaultRoute;this.viewLocation=typeof opts.viewLocation!=="undefined"?opts.viewLocation:this.viewLocation}var moostaka=this;window.onhashchange=function(){moostaka.navigate(location.hash)};window.onload=function(){moostaka.navigate(location.hash)}};Moostaka.prototype.navigate=function(hash){if(location.hash!==hash){location.hash=hash}if(this.onnavigate){this.onnavigate(hash)}var routeMatch=false;for(var i=0;i<this.routes.length;i++){var params={};var hashParts=hash.split("/");if(typeof this.routes[i].pattern==="string"){var routeParts=this.routes[i].pattern.split("/");var thisRouteMatch=true;for(var x=0;x<routeParts.length;x++){if(routeParts[x]==="*"){break}if(routeParts.length!==hashParts.length){thisRouteMatch=false}if(routeParts[x].substring(0,1)!==":"){if(lowerCase(routeParts[x])!==lowerCase(hashParts[x])){thisRouteMatch=false}}else{var partName=routeParts[x].substring(1);params[partName]=hashParts[x]}}if(thisRouteMatch===true){routeMatch=true;this.routes[i].handler(params);return}}else{if(hash.replace("#/","").match(this.routes[i].pattern)){this.routes[i].handler({hash:hash.replace("#/","").split("/")});return}}}if(routeMatch===false){window.location=this.defaultRoute}};function lowerCase(value){if(value){return value.toLowerCase()}return value}function loadScript(url,callback){$.ajax({url:url,dataType:"script",success:callback,cache:true,async:true})}Moostaka.prototype.render=function(element,view,params,options,callback){if(!options){options={}}if(!params){params={}}if(options&&typeof options.tags==="undefined"){Mustache.tags=["{{","}}"]}if(options&&typeof options.append==="undefined"){options.append=false}$.ajax({url:this.viewLocation+"/"+view.replace(".mst","")+".mst",dataType:"text"}).done(function(template){if(options.append===true){$(element).append(window.Mustache.to_html($(template).html(),params))}else{$(element).empty();$(element).html(window.Mustache.to_html($(template).html(),params))}if(typeof callback!=="undefined"){callback()}})};Moostaka.prototype.getHtml=function(view,params,options,callback){if(!options){options={}}if(!params){params={}}if(typeof options.tags==="undefined"){Mustache.tags=["{{","}}"]}else{Mustache.tags=options.tags}if(typeof options.markdown==="undefined"){options.markdown=false}$.ajax({url:this.viewLocation+"/"+view.replace(".mst","")+".mst",dataType:"text"}).done(function(template){if(options.markdown===true){loadScript("https://cdnjs.cloudflare.com/ajax/libs/markdown-it/7.0.0/markdown-it.min.js",function(){var md=window.markdownit();var html='<script id="template" type="text/template">'+md.render(template)+"</script>";callback(window.Mustache.render($(html).html(),params))})}else{callback(window.Mustache.render($(template).html(),params))}})};Moostaka.prototype.route=function(pattern,handler){this.routes.push({pattern:pattern,handler:handler})};